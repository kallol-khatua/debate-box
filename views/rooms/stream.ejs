<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>Debate-Box</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/rooms/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.5/socket.io.js" integrity="sha512-2rUSTSAeOO02jF6eBqENNqPs1EohenJ5j+1dgDPdXSLz9nOlrr8DJk4zW/lDy8rjhGCSonW3Gx812XJQIKZKJQ==" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/rooms/style.css">


</head>

<body>
    <div class="main-wrap">
        <div class="call-wrap card" style="z-index: 99">
            <a id='meetingid' href="#" style="color: black;"></a>
            <div class="remote-video-wrap" id="remote-video" style="margin-bottom:0;background-color:rgb(131 131 131); display: flex;flex-wrap: wrap;">
                <% for(joineduser of onlineUsers){ %>
                    <% if(joineduser.memberId._id != currUser._id){ %>
                        <div id="<%= joineduser.memberId._id %>" class="remote-user other div-center-column"> 
                            <h5 class="div-center"><%= joineduser.memberId.username %></h5>
                            <div class="div-center">
                                <video autoplay id="<%= joineduser.memberId._id %>video" ></video>
                                <audio autoplay id="<%= joineduser.memberId._id %>audio" ></audio>
                            </div>
                        </div>
                    <% } %>
                <% } %>
                <div>
                    <div id="localUser" class="userbox remote-user div-center" style="flex-direction: column; height:100%;">
                        <h5 class="div-center"><%= currUser.username %>(You)</h5>
                        <div class="div-center">
                            <video autoplay id="localStreamcideo"></video>
                            <audio autoplay id="localStreamaudio" ></audio>
                        </div>
                    </div>
                </div>
            </div>

           
         

        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="/js/rooms/materialize.min.js"></script>
    <script src="/js/rooms/client.js"></script>
    
    <script>
        let id = "<%= currUser._id %>";
        let socket = io("/stream-debate", {auth: { token: id,}});
        // console.log(socket)
        // socket.on("connect", () => {
        //     if(socket) {
        //         console.log(socket)
        //     }
        // })

        socket.on('getOfflineUser', async (data) => {
            // console.log(data)
            document.getElementById(data).remove();
        });

        socket.on('getOnlineUser', async (data) => {
            console.log(data)
            let videoPlayer = document.getElementById("remote-video");
            let html = `<div id=${data.userId} class="remote-user other div-center-column"> 
                            <h5 class="div-center">${data.user.username}</h5>
                            <div class="div-center">
                                <video autoplay id=${data.userId}video ></video>
                                <audio autoplay id=${data.userId}audio ></audio>
                            </div>
                        </div>`;
            videoPlayer.insertAdjacentHTML("afterbegin", html);
        });

    </script>
    <script>

    </script>

</body>

</html>
